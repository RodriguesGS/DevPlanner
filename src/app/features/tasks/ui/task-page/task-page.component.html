<div class="toolbar">
  <input
    #searchInput
    class="search"
    type="text"
    placeholder="Pesquisar tarefas..."
    [value]="search()"
    (input)="search.set(searchInput.value)"
    />


  <button class="btn" (click)="openCreateModal()">Criar Tarefa</button>
</div>

<div cdkDropListGroup class="board">
  <section class="column">
    <header>
      <h3>Backlog</h3>
      <span class="count">{{ backlog().length }}</span>
    </header>

    <div
      class="list"
      cdkDropList
      [cdkDropListData]="backlog()"
      (cdkDropListDropped)="onDrop($event, 'BACKLOG')"
      [cdkDropListConnectedTo]="[ids.DEV]"
    >
      <article class="card" *ngFor="let t of backlog(); trackBy: trackById" cdkDrag>
        <div class="title">{{ t.title }}</div>
        <div class="meta">
          <span class="pill" [style.background]="priorityColor(t.priority)">
            {{ t.priority }}
          </span>
          <span class="due" *ngIf="t.dueDate">Até {{ t.dueDate | date:'dd/MM' }}</span>
        </div>
      </article>
    </div>
  </section>

  <section class="column">
    <header>
      <h3>Em Desenvolvimento</h3>
      <span class="count">{{ dev().length }}</span>
    </header>

    <div
      class="list"
      cdkDropList
      [cdkDropListData]="dev()"
      (cdkDropListDropped)="onDrop($event, 'DEV')"
      [cdkDropListConnectedTo]="[ids.BACKLOG, ids.VALIDACAO]"
    >
      <article class="card" *ngFor="let t of dev(); trackBy: trackById" cdkDrag>
        <div class="title">{{ t.title }}</div>
        <div class="meta">
          <span class="pill" [style.background]="priorityColor(t.priority)">
            {{ t.priority }}
          </span>
          <span class="due" *ngIf="t.dueDate">Até {{ t.dueDate | date:'dd/MM' }}</span>
        </div>
      </article>
    </div>
  </section>

  <section class="column">
    <header>
      <h3>Validação</h3>
      <span class="count">{{ review().length }}</span>
    </header>

    <div
      class="list"
      cdkDropList
      [cdkDropListData]="review()"
      (cdkDropListDropped)="onDrop($event, 'VALIDACAO')"
      [cdkDropListConnectedTo]="[ids.DEV, ids.FINALIZADO]"
    >
      <article class="card" *ngFor="let t of review(); trackBy: trackById" cdkDrag>
        <div class="title">{{ t.title }}</div>
        <div class="meta">
          <span class="pill" [style.background]="priorityColor(t.priority)">
            {{ t.priority }}
          </span>
          <span class="due" *ngIf="t.dueDate">Até {{ t.dueDate | date:'dd/MM' }}</span>
        </div>
      </article>
    </div>
  </section>

  <section class="column">
    <header>
      <h3>Finalizado</h3>
      <span class="count">{{ done().length }}</span>
    </header>

    <div
      class="list"
      cdkDropList
      [cdkDropListData]="done()"
      (cdkDropListDropped)="onDrop($event, 'FINALIZADO')"
      [cdkDropListConnectedTo]="[ids.VALIDACAO]"
    >
      <article class="card done" *ngFor="let t of done(); trackBy: trackById" cdkDrag>
        <div class="title">{{ t.title }}</div>
        <div class="meta">
          <span class="pill" [style.background]="priorityColor(t.priority)">
            {{ t.priority }}
          </span>
          <span class="due" *ngIf="t.completedAt">
            Concluída {{ t.completedAt | date:'dd/MM' }}
          </span>
        </div>
      </article>
    </div>
  </section>
</div>

<div class="modal-overlay" *ngIf="showCreateModal()" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Nova Tarefa</h2>

    <form (ngSubmit)="submitNewTask()">
      <div class="form-group">
        <label for="title">Título *</label>
        <input
          id="title"
          type="text"
          [(ngModel)]="newTaskTitle"
          name="title"
          placeholder="Digite o título da tarefa"
          required
        />
      </div>

      <div class="form-group">
        <label for="description">Descrição</label>
        <textarea
          id="description"
          [(ngModel)]="newTaskDescription"
          name="description"
          placeholder="Digite a descrição (opcional)"
          rows="3"
        ></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="priority">Prioridade *</label>
          <select
            id="priority"
            [(ngModel)]="newTaskPriority"
            name="priority"
          >
            <option value="BAIXA">Baixa</option>
            <option value="MEDIA">Média</option>
            <option value="ALTA">Alta</option>
          </select>
        </div>

        <div class="form-group">
          <label for="dueDate">Data de Vencimento</label>
          <input
            id="dueDate"
            type="date"
            [(ngModel)]="newTaskDueDate"
            name="dueDate"
          />
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" (click)="closeCreateModal()">
          Cancelar
        </button>
        <button type="submit" class="btn-submit">
          Criar Tarefa
        </button>
      </div>
    </form>
  </div>
</div>
